.include "macros.inc"
.file "dolphin_trk.c"

# 0x80005518 - 0x8000563C
.section .init, "ax"
.balign 4
.sym gTRKInterruptVectorTableEnd, global

.fn __TRK_reset, global
/* 80005518 000025F8  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8000551C 000025FC  7C 08 02 A6 */	mflr r0
/* 80005520 00002600  3C 60 80 38 */	lis r3, lc_base@ha
/* 80005524 00002604  90 01 00 24 */	stw r0, 0x24(r1)
/* 80005528 00002608  38 63 12 50 */	addi r3, r3, lc_base@l
/* 8000552C 0000260C  BF 61 00 0C */	stmw r27, 0xc(r1)
/* 80005530 00002610  80 63 00 00 */	lwz r3, 0x0(r3)
/* 80005534 00002614  28 03 00 44 */	cmplwi r3, 0x44
/* 80005538 00002618  41 81 00 2C */	bgt .L_80005564
/* 8000553C 0000261C  38 03 40 00 */	addi r0, r3, 0x4000
/* 80005540 00002620  28 00 00 44 */	cmplwi r0, 0x44
/* 80005544 00002624  40 81 00 20 */	ble .L_80005564
/* 80005548 00002628  3C 60 80 38 */	lis r3, gTRKCPUState@ha
/* 8000554C 0000262C  38 63 0D 78 */	addi r3, r3, gTRKCPUState@l
/* 80005550 00002630  80 03 02 38 */	lwz r0, 0x238(r3)
/* 80005554 00002634  54 00 07 BF */	clrlwi. r0, r0, 30
/* 80005558 00002638  41 82 00 0C */	beq .L_80005564
/* 8000555C 0000263C  38 A0 00 44 */	li r5, 0x44
/* 80005560 00002640  48 00 00 0C */	b .L_8000556C
.L_80005564:
/* 80005564 00002644  3C 60 80 00 */	lis r3, 0x8000
/* 80005568 00002648  38 A3 00 44 */	addi r5, r3, 0x44
.L_8000556C:
/* 8000556C 0000264C  3C 80 80 2B */	lis r4, TRK_ISR_OFFSETS@ha
/* 80005570 00002650  3C 60 80 38 */	lis r3, gTRKCPUState@ha
/* 80005574 00002654  83 A5 00 00 */	lwz r29, 0x0(r5)
/* 80005578 00002658  3B E4 76 58 */	addi r31, r4, TRK_ISR_OFFSETS@l
/* 8000557C 0000265C  3B C3 0D 78 */	addi r30, r3, gTRKCPUState@l
/* 80005580 00002660  3B 80 00 00 */	li r28, 0x0
.L_80005584:
/* 80005584 00002664  38 00 00 01 */	li r0, 0x1
/* 80005588 00002668  7C 00 E0 30 */	slw r0, r0, r28
/* 8000558C 0000266C  7F A0 00 39 */	and. r0, r29, r0
/* 80005590 00002670  41 82 00 88 */	beq .L_80005618
/* 80005594 00002674  3C 60 80 38 */	lis r3, lc_base@ha
/* 80005598 00002678  80 DF 00 00 */	lwz r6, 0x0(r31)
/* 8000559C 0000267C  38 63 12 50 */	addi r3, r3, lc_base@l
/* 800055A0 00002680  80 63 00 00 */	lwz r3, 0x0(r3)
/* 800055A4 00002684  7C 06 18 40 */	cmplw r6, r3
/* 800055A8 00002688  41 80 00 24 */	blt .L_800055CC
/* 800055AC 0000268C  38 03 40 00 */	addi r0, r3, 0x4000
/* 800055B0 00002690  7C 06 00 40 */	cmplw r6, r0
/* 800055B4 00002694  40 80 00 18 */	bge .L_800055CC
/* 800055B8 00002698  80 1E 02 38 */	lwz r0, 0x238(r30)
/* 800055BC 0000269C  54 00 07 BF */	clrlwi. r0, r0, 30
/* 800055C0 000026A0  41 82 00 0C */	beq .L_800055CC
/* 800055C4 000026A4  7C DB 33 78 */	mr r27, r6
/* 800055C8 000026A8  48 00 00 2C */	b .L_800055F4
.L_800055CC:
/* 800055CC 000026AC  3C 00 7E 00 */	lis r0, 0x7e00
/* 800055D0 000026B0  7C 06 00 40 */	cmplw r6, r0
/* 800055D4 000026B4  41 80 00 18 */	blt .L_800055EC
/* 800055D8 000026B8  3C 00 80 00 */	lis r0, 0x8000
/* 800055DC 000026BC  7C 06 00 40 */	cmplw r6, r0
/* 800055E0 000026C0  41 81 00 0C */	bgt .L_800055EC
/* 800055E4 000026C4  7C DB 33 78 */	mr r27, r6
/* 800055E8 000026C8  48 00 00 0C */	b .L_800055F4
.L_800055EC:
/* 800055EC 000026CC  54 C0 00 BE */	clrlwi r0, r6, 2
/* 800055F0 000026D0  64 1B 80 00 */	oris r27, r0, 0x8000
.L_800055F4:
/* 800055F4 000026D4  3C 80 80 00 */	lis r4, gTRKInterruptVectorTable@ha
/* 800055F8 000026D8  7F 63 DB 78 */	mr r3, r27
/* 800055FC 000026DC  38 04 35 E4 */	addi r0, r4, gTRKInterruptVectorTable@l
/* 80005600 000026E0  38 A0 01 00 */	li r5, 0x100
/* 80005604 000026E4  7C 80 32 14 */	add r4, r0, r6
/* 80005608 000026E8  4B FF DF B9 */	bl TRK_memcpy
/* 8000560C 000026EC  7F 63 DB 78 */	mr r3, r27
/* 80005610 000026F0  38 80 01 00 */	li r4, 0x100
/* 80005614 000026F4  48 1E E4 DD */	bl TRK_flush_cache
.L_80005618:
/* 80005618 000026F8  3B 9C 00 01 */	addi r28, r28, 0x1
/* 8000561C 000026FC  3B FF 00 04 */	addi r31, r31, 0x4
/* 80005620 00002700  2C 1C 00 0E */	cmpwi r28, 0xe
/* 80005624 00002704  40 81 FF 60 */	ble .L_80005584
/* 80005628 00002708  BB 61 00 0C */	lmw r27, 0xc(r1)
/* 8000562C 0000270C  80 01 00 24 */	lwz r0, 0x24(r1)
/* 80005630 00002710  7C 08 03 A6 */	mtlr r0
/* 80005634 00002714  38 21 00 20 */	addi r1, r1, 0x20
/* 80005638 00002718  4E 80 00 20 */	blr
.endfn __TRK_reset

# 0x801F5780 - 0x801F58D8
.text
.balign 4

.fn InitMetroTRK, global
/* 801F5780 001F2860  38 21 FF FC */	addi r1, r1, -0x4
/* 801F5784 001F2864  90 61 00 00 */	stw r3, 0x0(r1)
/* 801F5788 001F2868  3C 60 80 38 */	lis r3, gTRKCPUState@h
/* 801F578C 001F286C  60 63 0D 78 */	ori r3, r3, gTRKCPUState@l
/* 801F5790 001F2870  BC 03 00 00 */	stmw r0, 0x0(r3)
/* 801F5794 001F2874  80 81 00 00 */	lwz r4, 0x0(r1)
/* 801F5798 001F2878  38 21 00 04 */	addi r1, r1, 0x4
/* 801F579C 001F287C  90 23 00 04 */	stw r1, 0x4(r3)
/* 801F57A0 001F2880  90 83 00 0C */	stw r4, 0xc(r3)
/* 801F57A4 001F2884  7C 88 02 A6 */	mflr r4
/* 801F57A8 001F2888  90 83 00 84 */	stw r4, 0x84(r3)
/* 801F57AC 001F288C  90 83 00 80 */	stw r4, 0x80(r3)
/* 801F57B0 001F2890  7C 80 00 26 */	mfcr r4
/* 801F57B4 001F2894  90 83 00 88 */	stw r4, 0x88(r3)
/* 801F57B8 001F2898  7C 80 00 A6 */	mfmsr r4
/* 801F57BC 001F289C  60 83 80 00 */	ori r3, r4, 0x8000
/* 801F57C0 001F28A0  68 63 80 00 */	xori r3, r3, 0x8000
/* 801F57C4 001F28A4  7C 60 01 24 */	mtmsr r3
/* 801F57C8 001F28A8  7C 9B 03 A6 */	mtsrr1 r4
/* 801F57CC 001F28AC  48 00 01 0D */	bl TRKSaveExtended1Block
/* 801F57D0 001F28B0  3C 60 80 38 */	lis r3, gTRKCPUState@h
/* 801F57D4 001F28B4  60 63 0D 78 */	ori r3, r3, gTRKCPUState@l
/* 801F57D8 001F28B8  B8 03 00 00 */	.4byte 0xB8030000 /* illegal: lmw r0, 0x0(r3) */
/* 801F57DC 001F28BC  38 00 00 00 */	li r0, 0x0
/* 801F57E0 001F28C0  7C 12 FB A6 */	mtspr IABR, r0
/* 801F57E4 001F28C4  7C 15 FB A6 */	mtspr DABR, r0
/* 801F57E8 001F28C8  3C 20 80 3D */	lis r1, _db_stack_addr@h
/* 801F57EC 001F28CC  60 21 9A 50 */	ori r1, r1, _db_stack_addr@l
/* 801F57F0 001F28D0  7C A3 2B 78 */	mr r3, r5
/* 801F57F4 001F28D4  48 00 08 79 */	bl InitMetroTRKCommTable
/* 801F57F8 001F28D8  2C 03 00 01 */	cmpwi r3, 0x1
/* 801F57FC 001F28DC  40 82 00 14 */	bne .L_801F5810
/* 801F5800 001F28E0  80 83 00 84 */	lwz r4, 0x84(r3)
/* 801F5804 001F28E4  7C 88 03 A6 */	mtlr r4
/* 801F5808 001F28E8  B8 03 00 00 */	.4byte 0xB8030000 /* illegal: lmw r0, 0x0(r3) */
/* 801F580C 001F28EC  4E 80 00 20 */	blr
.L_801F5810:
/* 801F5810 001F28F0  48 00 04 40 */	b TRK_main
.endfn InitMetroTRK

.fn TRKInitializeTarget, global
/* 801F5814 001F28F4  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 801F5818 001F28F8  7C 08 02 A6 */	mflr r0
/* 801F581C 001F28FC  3C 60 80 38 */	lis r3, gTRKState@ha
/* 801F5820 001F2900  90 01 00 14 */	stw r0, 0x14(r1)
/* 801F5824 001F2904  38 00 00 01 */	li r0, 0x1
/* 801F5828 001F2908  38 63 0C D4 */	addi r3, r3, gTRKState@l
/* 801F582C 001F290C  90 03 00 98 */	stw r0, 0x98(r3)
/* 801F5830 001F2910  4B FF E3 B1 */	bl __TRK_get_MSR
/* 801F5834 001F2914  3C A0 80 38 */	lis r5, gTRKState@ha
/* 801F5838 001F2918  3C 80 80 38 */	lis r4, lc_base@ha
/* 801F583C 001F291C  38 A5 0C D4 */	addi r5, r5, gTRKState@l
/* 801F5840 001F2920  3C 00 E0 00 */	lis r0, 0xe000
/* 801F5844 001F2924  90 65 00 8C */	stw r3, 0x8c(r5)
/* 801F5848 001F2928  38 60 00 00 */	li r3, 0x0
/* 801F584C 001F292C  90 04 12 50 */	stw r0, lc_base@l(r4)
/* 801F5850 001F2930  80 01 00 14 */	lwz r0, 0x14(r1)
/* 801F5854 001F2934  7C 08 03 A6 */	mtlr r0
/* 801F5858 001F2938  38 21 00 10 */	addi r1, r1, 0x10
/* 801F585C 001F293C  4E 80 00 20 */	blr
.endfn TRKInitializeTarget

.fn TRKTargetTranslate, global
/* 801F5860 001F2940  3C 80 80 38 */	lis r4, lc_base@ha
/* 801F5864 001F2944  38 84 12 50 */	addi r4, r4, lc_base@l
/* 801F5868 001F2948  80 84 00 00 */	lwz r4, 0x0(r4)
/* 801F586C 001F294C  7C 03 20 40 */	cmplw r3, r4
/* 801F5870 001F2950  41 80 00 24 */	blt .L_801F5894
/* 801F5874 001F2954  38 04 40 00 */	addi r0, r4, 0x4000
/* 801F5878 001F2958  7C 03 00 40 */	cmplw r3, r0
/* 801F587C 001F295C  40 80 00 18 */	bge .L_801F5894
/* 801F5880 001F2960  3C 80 80 38 */	lis r4, gTRKCPUState@ha
/* 801F5884 001F2964  38 84 0D 78 */	addi r4, r4, gTRKCPUState@l
/* 801F5888 001F2968  80 04 02 38 */	lwz r0, 0x238(r4)
/* 801F588C 001F296C  54 00 07 BF */	clrlwi. r0, r0, 30
/* 801F5890 001F2970  4C 82 00 20 */	bnelr
.L_801F5894:
/* 801F5894 001F2974  3C 00 7E 00 */	lis r0, 0x7e00
/* 801F5898 001F2978  7C 03 00 40 */	cmplw r3, r0
/* 801F589C 001F297C  41 80 00 10 */	blt .L_801F58AC
/* 801F58A0 001F2980  3C 00 80 00 */	lis r0, 0x8000
/* 801F58A4 001F2984  7C 03 00 40 */	cmplw r3, r0
/* 801F58A8 001F2988  4C 81 00 20 */	blelr
.L_801F58AC:
/* 801F58AC 001F298C  54 60 00 BE */	clrlwi r0, r3, 2
/* 801F58B0 001F2990  64 03 80 00 */	oris r3, r0, 0x8000
/* 801F58B4 001F2994  4E 80 00 20 */	blr
.endfn TRKTargetTranslate

.fn EnableMetroTRKInterrupts, global
/* 801F58B8 001F2998  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 801F58BC 001F299C  7C 08 02 A6 */	mflr r0
/* 801F58C0 001F29A0  90 01 00 14 */	stw r0, 0x14(r1)
/* 801F58C4 001F29A4  48 00 07 3D */	bl EnableEXI2Interrupts
/* 801F58C8 001F29A8  80 01 00 14 */	lwz r0, 0x14(r1)
/* 801F58CC 001F29AC  7C 08 03 A6 */	mtlr r0
/* 801F58D0 001F29B0  38 21 00 10 */	addi r1, r1, 0x10
/* 801F58D4 001F29B4  4E 80 00 20 */	blr
.endfn EnableMetroTRKInterrupts

# 0x802B7658 - 0x802B7698
.data
.balign 8

.obj TRK_ISR_OFFSETS, local
	.4byte 0x00000100
	.4byte 0x00000200
	.4byte 0x00000300
	.4byte 0x00000400
	.4byte 0x00000500
	.4byte 0x00000600
	.4byte 0x00000700
	.4byte 0x00000800
	.4byte 0x00000900
	.4byte 0x00000C00
	.4byte 0x00000D00
	.4byte 0x00000F00
	.4byte 0x00001300
	.4byte 0x00001400
	.4byte 0x00001700
.endobj TRK_ISR_OFFSETS
	.4byte 0x00000000

# 0x80381250 - 0x80381258
.section .bss, "wa", @nobits
.balign 8

.obj lc_base, local
	.skip 0x4
.endobj lc_base
	.skip 0x4
