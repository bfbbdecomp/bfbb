.include "macros.inc"
.file "OSAlloc.c"

# 0x801D1D54 - 0x801D2064
.text
.balign 4

.fn DLInsert, local
/* 801D1D54 001CEE34  38 E3 00 00 */	addi r7, r3, 0x0
/* 801D1D58 001CEE38  38 C0 00 00 */	li r6, 0x0
/* 801D1D5C 001CEE3C  48 00 00 14 */	b .L_801D1D70
.L_801D1D60:
/* 801D1D60 001CEE40  7C 04 38 40 */	cmplw r4, r7
/* 801D1D64 001CEE44  40 81 00 14 */	ble .L_801D1D78
/* 801D1D68 001CEE48  7C E6 3B 78 */	mr r6, r7
/* 801D1D6C 001CEE4C  80 E7 00 04 */	lwz r7, 0x4(r7)
.L_801D1D70:
/* 801D1D70 001CEE50  28 07 00 00 */	cmplwi r7, 0x0
/* 801D1D74 001CEE54  40 82 FF EC */	bne .L_801D1D60
.L_801D1D78:
/* 801D1D78 001CEE58  90 E4 00 04 */	stw r7, 0x4(r4)
/* 801D1D7C 001CEE5C  28 07 00 00 */	cmplwi r7, 0x0
/* 801D1D80 001CEE60  90 C4 00 00 */	stw r6, 0x0(r4)
/* 801D1D84 001CEE64  41 82 00 38 */	beq .L_801D1DBC
/* 801D1D88 001CEE68  90 87 00 00 */	stw r4, 0x0(r7)
/* 801D1D8C 001CEE6C  80 A4 00 08 */	lwz r5, 0x8(r4)
/* 801D1D90 001CEE70  7C 04 2A 14 */	add r0, r4, r5
/* 801D1D94 001CEE74  7C 00 38 40 */	cmplw r0, r7
/* 801D1D98 001CEE78  40 82 00 24 */	bne .L_801D1DBC
/* 801D1D9C 001CEE7C  80 07 00 08 */	lwz r0, 0x8(r7)
/* 801D1DA0 001CEE80  7C 05 02 14 */	add r0, r5, r0
/* 801D1DA4 001CEE84  90 04 00 08 */	stw r0, 0x8(r4)
/* 801D1DA8 001CEE88  80 E7 00 04 */	lwz r7, 0x4(r7)
/* 801D1DAC 001CEE8C  28 07 00 00 */	cmplwi r7, 0x0
/* 801D1DB0 001CEE90  90 E4 00 04 */	stw r7, 0x4(r4)
/* 801D1DB4 001CEE94  41 82 00 08 */	beq .L_801D1DBC
/* 801D1DB8 001CEE98  90 87 00 00 */	stw r4, 0x0(r7)
.L_801D1DBC:
/* 801D1DBC 001CEE9C  28 06 00 00 */	cmplwi r6, 0x0
/* 801D1DC0 001CEEA0  41 82 00 38 */	beq .L_801D1DF8
/* 801D1DC4 001CEEA4  90 86 00 04 */	stw r4, 0x4(r6)
/* 801D1DC8 001CEEA8  80 A6 00 08 */	lwz r5, 0x8(r6)
/* 801D1DCC 001CEEAC  7C 06 2A 14 */	add r0, r6, r5
/* 801D1DD0 001CEEB0  7C 00 20 40 */	cmplw r0, r4
/* 801D1DD4 001CEEB4  4C 82 00 20 */	bnelr
/* 801D1DD8 001CEEB8  80 04 00 08 */	lwz r0, 0x8(r4)
/* 801D1DDC 001CEEBC  28 07 00 00 */	cmplwi r7, 0x0
/* 801D1DE0 001CEEC0  7C 05 02 14 */	add r0, r5, r0
/* 801D1DE4 001CEEC4  90 06 00 08 */	stw r0, 0x8(r6)
/* 801D1DE8 001CEEC8  90 E6 00 04 */	stw r7, 0x4(r6)
/* 801D1DEC 001CEECC  4D 82 00 20 */	beqlr
/* 801D1DF0 001CEED0  90 C7 00 00 */	stw r6, 0x0(r7)
/* 801D1DF4 001CEED4  4E 80 00 20 */	blr
.L_801D1DF8:
/* 801D1DF8 001CEED8  7C 83 23 78 */	mr r3, r4
/* 801D1DFC 001CEEDC  4E 80 00 20 */	blr
.endfn DLInsert

.fn OSAllocFromHeap, global
/* 801D1E00 001CEEE0  1C 03 00 0C */	mulli r0, r3, 0xc
/* 801D1E04 001CEEE4  80 6D 9C 48 */	lwz r3, HeapArray@sda21(r13)
/* 801D1E08 001CEEE8  7C A3 02 14 */	add r5, r3, r0
/* 801D1E0C 001CEEEC  38 04 00 3F */	addi r0, r4, 0x3f
/* 801D1E10 001CEEF0  80 C5 00 04 */	lwz r6, 0x4(r5)
/* 801D1E14 001CEEF4  54 03 00 34 */	clrrwi r3, r0, 5
/* 801D1E18 001CEEF8  48 00 00 14 */	b .L_801D1E2C
.L_801D1E1C:
/* 801D1E1C 001CEEFC  80 06 00 08 */	lwz r0, 0x8(r6)
/* 801D1E20 001CEF00  7C 03 00 00 */	cmpw r3, r0
/* 801D1E24 001CEF04  40 81 00 10 */	ble .L_801D1E34
/* 801D1E28 001CEF08  80 C6 00 04 */	lwz r6, 0x4(r6)
.L_801D1E2C:
/* 801D1E2C 001CEF0C  28 06 00 00 */	cmplwi r6, 0x0
/* 801D1E30 001CEF10  40 82 FF EC */	bne .L_801D1E1C
.L_801D1E34:
/* 801D1E34 001CEF14  28 06 00 00 */	cmplwi r6, 0x0
/* 801D1E38 001CEF18  40 82 00 0C */	bne .L_801D1E44
/* 801D1E3C 001CEF1C  38 60 00 00 */	li r3, 0x0
/* 801D1E40 001CEF20  4E 80 00 20 */	blr
.L_801D1E44:
/* 801D1E44 001CEF24  80 06 00 08 */	lwz r0, 0x8(r6)
/* 801D1E48 001CEF28  7C 03 00 50 */	subf r0, r3, r0
/* 801D1E4C 001CEF2C  28 00 00 40 */	cmplwi r0, 0x40
/* 801D1E50 001CEF30  40 80 00 40 */	bge .L_801D1E90
/* 801D1E54 001CEF34  80 86 00 04 */	lwz r4, 0x4(r6)
/* 801D1E58 001CEF38  80 65 00 04 */	lwz r3, 0x4(r5)
/* 801D1E5C 001CEF3C  28 04 00 00 */	cmplwi r4, 0x0
/* 801D1E60 001CEF40  41 82 00 0C */	beq .L_801D1E6C
/* 801D1E64 001CEF44  80 06 00 00 */	lwz r0, 0x0(r6)
/* 801D1E68 001CEF48  90 04 00 00 */	stw r0, 0x0(r4)
.L_801D1E6C:
/* 801D1E6C 001CEF4C  80 86 00 00 */	lwz r4, 0x0(r6)
/* 801D1E70 001CEF50  28 04 00 00 */	cmplwi r4, 0x0
/* 801D1E74 001CEF54  40 82 00 0C */	bne .L_801D1E80
/* 801D1E78 001CEF58  80 66 00 04 */	lwz r3, 0x4(r6)
/* 801D1E7C 001CEF5C  48 00 00 0C */	b .L_801D1E88
.L_801D1E80:
/* 801D1E80 001CEF60  80 06 00 04 */	lwz r0, 0x4(r6)
/* 801D1E84 001CEF64  90 04 00 04 */	stw r0, 0x4(r4)
.L_801D1E88:
/* 801D1E88 001CEF68  90 65 00 04 */	stw r3, 0x4(r5)
/* 801D1E8C 001CEF6C  48 00 00 48 */	b .L_801D1ED4
.L_801D1E90:
/* 801D1E90 001CEF70  90 66 00 08 */	stw r3, 0x8(r6)
/* 801D1E94 001CEF74  7C 86 1A 14 */	add r4, r6, r3
/* 801D1E98 001CEF78  90 04 00 08 */	stw r0, 0x8(r4)
/* 801D1E9C 001CEF7C  80 06 00 00 */	lwz r0, 0x0(r6)
/* 801D1EA0 001CEF80  90 04 00 00 */	stw r0, 0x0(r4)
/* 801D1EA4 001CEF84  80 06 00 04 */	lwz r0, 0x4(r6)
/* 801D1EA8 001CEF88  90 04 00 04 */	stw r0, 0x4(r4)
/* 801D1EAC 001CEF8C  80 64 00 04 */	lwz r3, 0x4(r4)
/* 801D1EB0 001CEF90  28 03 00 00 */	cmplwi r3, 0x0
/* 801D1EB4 001CEF94  41 82 00 08 */	beq .L_801D1EBC
/* 801D1EB8 001CEF98  90 83 00 00 */	stw r4, 0x0(r3)
.L_801D1EBC:
/* 801D1EBC 001CEF9C  80 64 00 00 */	lwz r3, 0x0(r4)
/* 801D1EC0 001CEFA0  28 03 00 00 */	cmplwi r3, 0x0
/* 801D1EC4 001CEFA4  41 82 00 0C */	beq .L_801D1ED0
/* 801D1EC8 001CEFA8  90 83 00 04 */	stw r4, 0x4(r3)
/* 801D1ECC 001CEFAC  48 00 00 08 */	b .L_801D1ED4
.L_801D1ED0:
/* 801D1ED0 001CEFB0  90 85 00 04 */	stw r4, 0x4(r5)
.L_801D1ED4:
/* 801D1ED4 001CEFB4  80 65 00 08 */	lwz r3, 0x8(r5)
/* 801D1ED8 001CEFB8  38 00 00 00 */	li r0, 0x0
/* 801D1EDC 001CEFBC  90 66 00 04 */	stw r3, 0x4(r6)
/* 801D1EE0 001CEFC0  28 03 00 00 */	cmplwi r3, 0x0
/* 801D1EE4 001CEFC4  90 06 00 00 */	stw r0, 0x0(r6)
/* 801D1EE8 001CEFC8  41 82 00 08 */	beq .L_801D1EF0
/* 801D1EEC 001CEFCC  90 C3 00 00 */	stw r6, 0x0(r3)
.L_801D1EF0:
/* 801D1EF0 001CEFD0  90 C5 00 08 */	stw r6, 0x8(r5)
/* 801D1EF4 001CEFD4  38 66 00 20 */	addi r3, r6, 0x20
/* 801D1EF8 001CEFD8  4E 80 00 20 */	blr
.endfn OSAllocFromHeap

.fn OSFreeToHeap, global
/* 801D1EFC 001CEFDC  7C 08 02 A6 */	mflr r0
/* 801D1F00 001CEFE0  38 C4 FF E0 */	addi r6, r4, -0x20
/* 801D1F04 001CEFE4  90 01 00 04 */	stw r0, 0x4(r1)
/* 801D1F08 001CEFE8  1C 03 00 0C */	mulli r0, r3, 0xc
/* 801D1F0C 001CEFEC  94 21 FF E8 */	stwu r1, -0x18(r1)
/* 801D1F10 001CEFF0  93 E1 00 14 */	stw r31, 0x14(r1)
/* 801D1F14 001CEFF4  80 8D 9C 48 */	lwz r4, HeapArray@sda21(r13)
/* 801D1F18 001CEFF8  80 66 00 04 */	lwz r3, 0x4(r6)
/* 801D1F1C 001CEFFC  7F E4 02 14 */	add r31, r4, r0
/* 801D1F20 001CF000  28 03 00 00 */	cmplwi r3, 0x0
/* 801D1F24 001CF004  80 BF 00 08 */	lwz r5, 0x8(r31)
/* 801D1F28 001CF008  7C C4 33 78 */	mr r4, r6
/* 801D1F2C 001CF00C  41 82 00 0C */	beq .L_801D1F38
/* 801D1F30 001CF010  80 04 00 00 */	lwz r0, 0x0(r4)
/* 801D1F34 001CF014  90 03 00 00 */	stw r0, 0x0(r3)
.L_801D1F38:
/* 801D1F38 001CF018  80 64 00 00 */	lwz r3, 0x0(r4)
/* 801D1F3C 001CF01C  28 03 00 00 */	cmplwi r3, 0x0
/* 801D1F40 001CF020  40 82 00 0C */	bne .L_801D1F4C
/* 801D1F44 001CF024  80 A4 00 04 */	lwz r5, 0x4(r4)
/* 801D1F48 001CF028  48 00 00 0C */	b .L_801D1F54
.L_801D1F4C:
/* 801D1F4C 001CF02C  80 04 00 04 */	lwz r0, 0x4(r4)
/* 801D1F50 001CF030  90 03 00 04 */	stw r0, 0x4(r3)
.L_801D1F54:
/* 801D1F54 001CF034  90 BF 00 08 */	stw r5, 0x8(r31)
/* 801D1F58 001CF038  80 7F 00 04 */	lwz r3, 0x4(r31)
/* 801D1F5C 001CF03C  4B FF FD F9 */	bl DLInsert
/* 801D1F60 001CF040  90 7F 00 04 */	stw r3, 0x4(r31)
/* 801D1F64 001CF044  80 01 00 1C */	lwz r0, 0x1c(r1)
/* 801D1F68 001CF048  83 E1 00 14 */	lwz r31, 0x14(r1)
/* 801D1F6C 001CF04C  38 21 00 18 */	addi r1, r1, 0x18
/* 801D1F70 001CF050  7C 08 03 A6 */	mtlr r0
/* 801D1F74 001CF054  4E 80 00 20 */	blr
.endfn OSFreeToHeap

.fn OSSetCurrentHeap, global
/* 801D1F78 001CF058  80 0D 86 40 */	lwz r0, __OSCurrHeap@sda21(r13)
/* 801D1F7C 001CF05C  90 6D 86 40 */	stw r3, __OSCurrHeap@sda21(r13)
/* 801D1F80 001CF060  7C 03 03 78 */	mr r3, r0
/* 801D1F84 001CF064  4E 80 00 20 */	blr
.endfn OSSetCurrentHeap

.fn OSInitAlloc, global
/* 801D1F88 001CF068  1C E5 00 0C */	mulli r7, r5, 0xc
/* 801D1F8C 001CF06C  90 6D 9C 48 */	stw r3, HeapArray@sda21(r13)
/* 801D1F90 001CF070  90 AD 9C 4C */	stw r5, NumHeaps@sda21(r13)
/* 801D1F94 001CF074  38 C0 00 00 */	li r6, 0x0
/* 801D1F98 001CF078  38 66 00 00 */	addi r3, r6, 0x0
/* 801D1F9C 001CF07C  39 00 00 00 */	li r8, 0x0
/* 801D1FA0 001CF080  38 A0 FF FF */	li r5, -0x1
/* 801D1FA4 001CF084  48 00 00 20 */	b .L_801D1FC4
.L_801D1FA8:
/* 801D1FA8 001CF088  80 0D 9C 48 */	lwz r0, HeapArray@sda21(r13)
/* 801D1FAC 001CF08C  39 08 00 01 */	addi r8, r8, 0x1
/* 801D1FB0 001CF090  7D 20 32 14 */	add r9, r0, r6
/* 801D1FB4 001CF094  90 A9 00 00 */	stw r5, 0x0(r9)
/* 801D1FB8 001CF098  38 C6 00 0C */	addi r6, r6, 0xc
/* 801D1FBC 001CF09C  90 69 00 08 */	stw r3, 0x8(r9)
/* 801D1FC0 001CF0A0  90 69 00 04 */	stw r3, 0x4(r9)
.L_801D1FC4:
/* 801D1FC4 001CF0A4  80 0D 9C 4C */	lwz r0, NumHeaps@sda21(r13)
/* 801D1FC8 001CF0A8  7C 08 00 00 */	cmpw r8, r0
/* 801D1FCC 001CF0AC  41 80 FF DC */	blt .L_801D1FA8
/* 801D1FD0 001CF0B0  80 6D 9C 48 */	lwz r3, HeapArray@sda21(r13)
/* 801D1FD4 001CF0B4  54 80 00 34 */	clrrwi r0, r4, 5
/* 801D1FD8 001CF0B8  38 80 FF FF */	li r4, -0x1
/* 801D1FDC 001CF0BC  90 0D 9C 54 */	stw r0, ArenaEnd@sda21(r13)
/* 801D1FE0 001CF0C0  7C 63 3A 14 */	add r3, r3, r7
/* 801D1FE4 001CF0C4  38 03 00 1F */	addi r0, r3, 0x1f
/* 801D1FE8 001CF0C8  90 8D 86 40 */	stw r4, __OSCurrHeap@sda21(r13)
/* 801D1FEC 001CF0CC  54 03 00 34 */	clrrwi r3, r0, 5
/* 801D1FF0 001CF0D0  90 6D 9C 50 */	stw r3, ArenaStart@sda21(r13)
/* 801D1FF4 001CF0D4  4E 80 00 20 */	blr
.endfn OSInitAlloc

.fn OSCreateHeap, global
/* 801D1FF8 001CF0D8  80 CD 9C 4C */	lwz r6, NumHeaps@sda21(r13)
/* 801D1FFC 001CF0DC  38 03 00 1F */	addi r0, r3, 0x1f
/* 801D2000 001CF0E0  80 AD 9C 48 */	lwz r5, HeapArray@sda21(r13)
/* 801D2004 001CF0E4  54 07 00 34 */	clrrwi r7, r0, 5
/* 801D2008 001CF0E8  2C 06 00 00 */	cmpwi r6, 0x0
/* 801D200C 001CF0EC  7C C9 03 A6 */	mtctr r6
/* 801D2010 001CF0F0  54 84 00 34 */	clrrwi r4, r4, 5
/* 801D2014 001CF0F4  38 60 00 00 */	li r3, 0x0
/* 801D2018 001CF0F8  40 81 00 44 */	ble .L_801D205C
.L_801D201C:
/* 801D201C 001CF0FC  80 05 00 00 */	lwz r0, 0x0(r5)
/* 801D2020 001CF100  2C 00 00 00 */	cmpwi r0, 0x0
/* 801D2024 001CF104  40 80 00 2C */	bge .L_801D2050
/* 801D2028 001CF108  7C 07 20 50 */	subf r0, r7, r4
/* 801D202C 001CF10C  90 05 00 00 */	stw r0, 0x0(r5)
/* 801D2030 001CF110  38 80 00 00 */	li r4, 0x0
/* 801D2034 001CF114  90 87 00 00 */	stw r4, 0x0(r7)
/* 801D2038 001CF118  90 87 00 04 */	stw r4, 0x4(r7)
/* 801D203C 001CF11C  80 05 00 00 */	lwz r0, 0x0(r5)
/* 801D2040 001CF120  90 07 00 08 */	stw r0, 0x8(r7)
/* 801D2044 001CF124  90 E5 00 04 */	stw r7, 0x4(r5)
/* 801D2048 001CF128  90 85 00 08 */	stw r4, 0x8(r5)
/* 801D204C 001CF12C  4E 80 00 20 */	blr
.L_801D2050:
/* 801D2050 001CF130  38 A5 00 0C */	addi r5, r5, 0xc
/* 801D2054 001CF134  38 63 00 01 */	addi r3, r3, 0x1
/* 801D2058 001CF138  42 00 FF C4 */	bdnz .L_801D201C
.L_801D205C:
/* 801D205C 001CF13C  38 60 FF FF */	li r3, -0x1
/* 801D2060 001CF140  4E 80 00 20 */	blr
.endfn OSCreateHeap

# 0x803CAF40 - 0x803CAF48
.section .sdata, "wa"
.balign 8

.obj __OSCurrHeap, global
	.4byte 0xFFFFFFFF
.endobj __OSCurrHeap
	.4byte 0x00000000

# 0x803CC548 - 0x803CC558
.section .sbss, "wa", @nobits
.balign 8

.obj HeapArray, local
	.skip 0x4
.endobj HeapArray

.obj NumHeaps, local
	.skip 0x4
.endobj NumHeaps

.obj ArenaStart, local
	.skip 0x4
.endobj ArenaStart

.obj ArenaEnd, local
	.skip 0x4
.endobj ArenaEnd
