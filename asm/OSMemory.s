.include "macros.inc"
.file "OSMemory.c"

# 0x801D4B94 - 0x801D4E6C
.text
.balign 4

.fn OnReset, local
/* 801D4B94 001D1C74  7C 08 02 A6 */	mflr r0
/* 801D4B98 001D1C78  2C 03 00 00 */	cmpwi r3, 0x0
/* 801D4B9C 001D1C7C  90 01 00 04 */	stw r0, 0x4(r1)
/* 801D4BA0 001D1C80  94 21 FF F8 */	stwu r1, -0x8(r1)
/* 801D4BA4 001D1C84  41 82 00 18 */	beq .L_801D4BBC
/* 801D4BA8 001D1C88  3C 60 CC 00 */	lis r3, 0xcc00
/* 801D4BAC 001D1C8C  38 00 00 FF */	li r0, 0xff
/* 801D4BB0 001D1C90  B0 03 40 10 */	sth r0, 0x4010(r3)
/* 801D4BB4 001D1C94  3C 60 F0 00 */	lis r3, 0xf000
/* 801D4BB8 001D1C98  4B FF FB 21 */	bl __OSMaskInterrupts
.L_801D4BBC:
/* 801D4BBC 001D1C9C  38 60 00 01 */	li r3, 0x1
/* 801D4BC0 001D1CA0  80 01 00 0C */	lwz r0, 0xc(r1)
/* 801D4BC4 001D1CA4  38 21 00 08 */	addi r1, r1, 0x8
/* 801D4BC8 001D1CA8  7C 08 03 A6 */	mtlr r0
/* 801D4BCC 001D1CAC  4E 80 00 20 */	blr
.endfn OnReset

.fn MEMIntrruptHandler, local
/* 801D4BD0 001D1CB0  7C 08 02 A6 */	mflr r0
/* 801D4BD4 001D1CB4  3C 60 CC 00 */	lis r3, 0xcc00
/* 801D4BD8 001D1CB8  90 01 00 04 */	stw r0, 0x4(r1)
/* 801D4BDC 001D1CBC  39 03 40 00 */	addi r8, r3, 0x4000
/* 801D4BE0 001D1CC0  38 00 00 00 */	li r0, 0x0
/* 801D4BE4 001D1CC4  94 21 FF F8 */	stwu r1, -0x8(r1)
/* 801D4BE8 001D1CC8  A0 E3 40 24 */	lhz r7, 0x4024(r3)
/* 801D4BEC 001D1CCC  3C 60 80 38 */	lis r3, __OSErrorTable@ha
/* 801D4BF0 001D1CD0  A0 C8 00 22 */	lhz r6, 0x22(r8)
/* 801D4BF4 001D1CD4  38 63 E0 10 */	addi r3, r3, __OSErrorTable@l
/* 801D4BF8 001D1CD8  A0 A8 00 1E */	lhz r5, 0x1e(r8)
/* 801D4BFC 001D1CDC  50 E6 81 9E */	rlwimi r6, r7, 16, 6, 15
/* 801D4C00 001D1CE0  B0 08 00 20 */	sth r0, 0x20(r8)
/* 801D4C04 001D1CE4  81 83 00 3C */	lwz r12, 0x3c(r3)
/* 801D4C08 001D1CE8  28 0C 00 00 */	cmplwi r12, 0x0
/* 801D4C0C 001D1CEC  41 82 00 18 */	beq .L_801D4C24
/* 801D4C10 001D1CF0  7D 88 03 A6 */	mtlr r12
/* 801D4C14 001D1CF4  38 60 00 0F */	li r3, 0xf
/* 801D4C18 001D1CF8  4C C6 31 82 */	crclr 4*cr1+eq
/* 801D4C1C 001D1CFC  4E 80 00 21 */	blrl
/* 801D4C20 001D1D00  48 00 00 0C */	b .L_801D4C2C
.L_801D4C24:
/* 801D4C24 001D1D04  38 60 00 0F */	li r3, 0xf
/* 801D4C28 001D1D08  4B FF E6 A1 */	bl __OSUnhandledException
.L_801D4C2C:
/* 801D4C2C 001D1D0C  80 01 00 0C */	lwz r0, 0xc(r1)
/* 801D4C30 001D1D10  38 21 00 08 */	addi r1, r1, 0x8
/* 801D4C34 001D1D14  7C 08 03 A6 */	mtlr r0
/* 801D4C38 001D1D18  4E 80 00 20 */	blr
.endfn MEMIntrruptHandler

.fn Config24MB, local
/* 801D4C3C 001D1D1C  38 E0 00 00 */	li r7, 0x0
/* 801D4C40 001D1D20  3C 80 00 00 */	lis r4, 0x0
/* 801D4C44 001D1D24  38 84 00 02 */	addi r4, r4, 0x2
/* 801D4C48 001D1D28  3C 60 80 00 */	lis r3, 0x8000
/* 801D4C4C 001D1D2C  38 63 01 FF */	addi r3, r3, 0x1ff
/* 801D4C50 001D1D30  3C C0 01 00 */	lis r6, 0x100
/* 801D4C54 001D1D34  38 C6 00 02 */	addi r6, r6, 0x2
/* 801D4C58 001D1D38  3C A0 81 00 */	lis r5, 0x8100
/* 801D4C5C 001D1D3C  38 A5 00 FF */	addi r5, r5, 0xff
/* 801D4C60 001D1D40  4C 00 01 2C */	isync
/* 801D4C64 001D1D44  7C F8 83 A6 */	mtdbatu 0, r7
/* 801D4C68 001D1D48  7C 99 83 A6 */	mtdbatl 0, r4
/* 801D4C6C 001D1D4C  7C 78 83 A6 */	mtdbatu 0, r3
/* 801D4C70 001D1D50  4C 00 01 2C */	isync
/* 801D4C74 001D1D54  7C F0 83 A6 */	mtibatu 0, r7
/* 801D4C78 001D1D58  7C 91 83 A6 */	mtibatl 0, r4
/* 801D4C7C 001D1D5C  7C 70 83 A6 */	mtibatu 0, r3
/* 801D4C80 001D1D60  4C 00 01 2C */	isync
/* 801D4C84 001D1D64  7C FC 83 A6 */	mtdbatu 2, r7
/* 801D4C88 001D1D68  7C DD 83 A6 */	mtdbatl 2, r6
/* 801D4C8C 001D1D6C  7C BC 83 A6 */	mtdbatu 2, r5
/* 801D4C90 001D1D70  4C 00 01 2C */	isync
/* 801D4C94 001D1D74  7C F4 83 A6 */	mtibatu 2, r7
/* 801D4C98 001D1D78  7C D5 83 A6 */	mtibatl 2, r6
/* 801D4C9C 001D1D7C  7C B4 83 A6 */	mtibatu 2, r5
/* 801D4CA0 001D1D80  4C 00 01 2C */	isync
/* 801D4CA4 001D1D84  7C 60 00 A6 */	mfmsr r3
/* 801D4CA8 001D1D88  60 63 00 30 */	ori r3, r3, 0x30
/* 801D4CAC 001D1D8C  7C 7B 03 A6 */	mtsrr1 r3
/* 801D4CB0 001D1D90  7C 68 02 A6 */	mflr r3
/* 801D4CB4 001D1D94  7C 7A 03 A6 */	mtsrr0 r3
/* 801D4CB8 001D1D98  4C 00 00 64 */	rfi
.endfn Config24MB

.fn Config48MB, local
/* 801D4CBC 001D1D9C  38 E0 00 00 */	li r7, 0x0
/* 801D4CC0 001D1DA0  3C 80 00 00 */	lis r4, 0x0
/* 801D4CC4 001D1DA4  38 84 00 02 */	addi r4, r4, 0x2
/* 801D4CC8 001D1DA8  3C 60 80 00 */	lis r3, 0x8000
/* 801D4CCC 001D1DAC  38 63 03 FF */	addi r3, r3, 0x3ff
/* 801D4CD0 001D1DB0  3C C0 02 00 */	lis r6, 0x200
/* 801D4CD4 001D1DB4  38 C6 00 02 */	addi r6, r6, 0x2
/* 801D4CD8 001D1DB8  3C A0 82 00 */	lis r5, 0x8200
/* 801D4CDC 001D1DBC  38 A5 01 FF */	addi r5, r5, 0x1ff
/* 801D4CE0 001D1DC0  4C 00 01 2C */	isync
/* 801D4CE4 001D1DC4  7C F8 83 A6 */	mtdbatu 0, r7
/* 801D4CE8 001D1DC8  7C 99 83 A6 */	mtdbatl 0, r4
/* 801D4CEC 001D1DCC  7C 78 83 A6 */	mtdbatu 0, r3
/* 801D4CF0 001D1DD0  4C 00 01 2C */	isync
/* 801D4CF4 001D1DD4  7C F0 83 A6 */	mtibatu 0, r7
/* 801D4CF8 001D1DD8  7C 91 83 A6 */	mtibatl 0, r4
/* 801D4CFC 001D1DDC  7C 70 83 A6 */	mtibatu 0, r3
/* 801D4D00 001D1DE0  4C 00 01 2C */	isync
/* 801D4D04 001D1DE4  7C FC 83 A6 */	mtdbatu 2, r7
/* 801D4D08 001D1DE8  7C DD 83 A6 */	mtdbatl 2, r6
/* 801D4D0C 001D1DEC  7C BC 83 A6 */	mtdbatu 2, r5
/* 801D4D10 001D1DF0  4C 00 01 2C */	isync
/* 801D4D14 001D1DF4  7C F4 83 A6 */	mtibatu 2, r7
/* 801D4D18 001D1DF8  7C D5 83 A6 */	mtibatl 2, r6
/* 801D4D1C 001D1DFC  7C B4 83 A6 */	mtibatu 2, r5
/* 801D4D20 001D1E00  4C 00 01 2C */	isync
/* 801D4D24 001D1E04  7C 60 00 A6 */	mfmsr r3
/* 801D4D28 001D1E08  60 63 00 30 */	ori r3, r3, 0x30
/* 801D4D2C 001D1E0C  7C 7B 03 A6 */	mtsrr1 r3
/* 801D4D30 001D1E10  7C 68 02 A6 */	mflr r3
/* 801D4D34 001D1E14  7C 7A 03 A6 */	mtsrr0 r3
/* 801D4D38 001D1E18  4C 00 00 64 */	rfi
.endfn Config48MB

.fn RealMode, local
/* 801D4D3C 001D1E1C  54 63 00 BE */	clrlwi r3, r3, 2
/* 801D4D40 001D1E20  7C 7A 03 A6 */	mtsrr0 r3
/* 801D4D44 001D1E24  7C 60 00 A6 */	mfmsr r3
/* 801D4D48 001D1E28  54 63 07 32 */	rlwinm r3, r3, 0, 28, 25
/* 801D4D4C 001D1E2C  7C 7B 03 A6 */	mtsrr1 r3
/* 801D4D50 001D1E30  4C 00 00 64 */	rfi
.endfn RealMode

.fn __OSInitMemoryProtection, global
/* 801D4D54 001D1E34  7C 08 02 A6 */	mflr r0
/* 801D4D58 001D1E38  90 01 00 04 */	stw r0, 0x4(r1)
/* 801D4D5C 001D1E3C  94 21 FF B0 */	stwu r1, -0x50(r1)
/* 801D4D60 001D1E40  BF 61 00 3C */	stmw r27, 0x3c(r1)
/* 801D4D64 001D1E44  3F 60 80 00 */	lis r27, 0x8000
/* 801D4D68 001D1E48  83 FB 00 F0 */	lwz r31, 0xf0(r27)
/* 801D4D6C 001D1E4C  4B FF F5 A5 */	bl OSDisableInterrupts
/* 801D4D70 001D1E50  3C 80 CC 00 */	lis r4, 0xcc00
/* 801D4D74 001D1E54  3B 84 40 00 */	addi r28, r4, 0x4000
/* 801D4D78 001D1E58  38 00 00 00 */	li r0, 0x0
/* 801D4D7C 001D1E5C  B0 1C 00 20 */	sth r0, 0x20(r28)
/* 801D4D80 001D1E60  38 00 00 FF */	li r0, 0xff
/* 801D4D84 001D1E64  7C 7E 1B 78 */	mr r30, r3
/* 801D4D88 001D1E68  B0 1C 00 10 */	sth r0, 0x10(r28)
/* 801D4D8C 001D1E6C  3C 60 F0 00 */	lis r3, 0xf000
/* 801D4D90 001D1E70  4B FF F9 49 */	bl __OSMaskInterrupts
/* 801D4D94 001D1E74  3C 60 80 1D */	lis r3, MEMIntrruptHandler@ha
/* 801D4D98 001D1E78  3B A3 4B D0 */	addi r29, r3, MEMIntrruptHandler@l
/* 801D4D9C 001D1E7C  7F A4 EB 78 */	mr r4, r29
/* 801D4DA0 001D1E80  38 60 00 00 */	li r3, 0x0
/* 801D4DA4 001D1E84  4B FF F5 B9 */	bl __OSSetInterruptHandler
/* 801D4DA8 001D1E88  7F A4 EB 78 */	mr r4, r29
/* 801D4DAC 001D1E8C  38 60 00 01 */	li r3, 0x1
/* 801D4DB0 001D1E90  4B FF F5 AD */	bl __OSSetInterruptHandler
/* 801D4DB4 001D1E94  7F A4 EB 78 */	mr r4, r29
/* 801D4DB8 001D1E98  38 60 00 02 */	li r3, 0x2
/* 801D4DBC 001D1E9C  4B FF F5 A1 */	bl __OSSetInterruptHandler
/* 801D4DC0 001D1EA0  7F A4 EB 78 */	mr r4, r29
/* 801D4DC4 001D1EA4  38 60 00 03 */	li r3, 0x3
/* 801D4DC8 001D1EA8  4B FF F5 95 */	bl __OSSetInterruptHandler
/* 801D4DCC 001D1EAC  7F A4 EB 78 */	mr r4, r29
/* 801D4DD0 001D1EB0  38 60 00 04 */	li r3, 0x4
/* 801D4DD4 001D1EB4  4B FF F5 89 */	bl __OSSetInterruptHandler
/* 801D4DD8 001D1EB8  3C 60 80 2B */	lis r3, ResetFunctionInfo@ha
/* 801D4DDC 001D1EBC  38 63 64 C0 */	addi r3, r3, ResetFunctionInfo@l
/* 801D4DE0 001D1EC0  48 00 04 59 */	bl OSRegisterResetFunction
/* 801D4DE4 001D1EC4  80 7B 00 F0 */	lwz r3, 0xf0(r27)
/* 801D4DE8 001D1EC8  80 1B 00 28 */	lwz r0, 0x28(r27)
/* 801D4DEC 001D1ECC  7C 03 00 40 */	cmplw r3, r0
/* 801D4DF0 001D1ED0  40 80 00 24 */	bge .L_801D4E14
/* 801D4DF4 001D1ED4  3C 03 FE 80 */	addis r0, r3, 0xfe80
/* 801D4DF8 001D1ED8  28 00 00 00 */	cmplwi r0, 0x0
/* 801D4DFC 001D1EDC  40 82 00 18 */	bne .L_801D4E14
/* 801D4E00 001D1EE0  3C 60 81 80 */	lis r3, 0x8180
/* 801D4E04 001D1EE4  3C 80 01 80 */	lis r4, 0x180
/* 801D4E08 001D1EE8  4B FF D5 25 */	bl DCInvalidateRange
/* 801D4E0C 001D1EEC  38 00 00 02 */	li r0, 0x2
/* 801D4E10 001D1EF0  B0 1C 00 28 */	sth r0, 0x28(r28)
.L_801D4E14:
/* 801D4E14 001D1EF4  3C 00 01 80 */	lis r0, 0x180
/* 801D4E18 001D1EF8  7C 1F 00 40 */	cmplw r31, r0
/* 801D4E1C 001D1EFC  41 81 00 14 */	bgt .L_801D4E30
/* 801D4E20 001D1F00  3C 60 80 1D */	lis r3, Config24MB@ha
/* 801D4E24 001D1F04  38 63 4C 3C */	addi r3, r3, Config24MB@l
/* 801D4E28 001D1F08  4B FF FF 15 */	bl RealMode
/* 801D4E2C 001D1F0C  48 00 00 1C */	b .L_801D4E48
.L_801D4E30:
/* 801D4E30 001D1F10  3C 00 03 00 */	lis r0, 0x300
/* 801D4E34 001D1F14  7C 1F 00 40 */	cmplw r31, r0
/* 801D4E38 001D1F18  41 81 00 10 */	bgt .L_801D4E48
/* 801D4E3C 001D1F1C  3C 60 80 1D */	lis r3, Config48MB@ha
/* 801D4E40 001D1F20  38 63 4C BC */	addi r3, r3, Config48MB@l
/* 801D4E44 001D1F24  4B FF FE F9 */	bl RealMode
.L_801D4E48:
/* 801D4E48 001D1F28  3C 60 08 00 */	lis r3, 0x800
/* 801D4E4C 001D1F2C  4B FF F9 15 */	bl __OSUnmaskInterrupts
/* 801D4E50 001D1F30  7F C3 F3 78 */	mr r3, r30
/* 801D4E54 001D1F34  4B FF F4 E5 */	bl OSRestoreInterrupts
/* 801D4E58 001D1F38  BB 61 00 3C */	lmw r27, 0x3c(r1)
/* 801D4E5C 001D1F3C  80 01 00 54 */	lwz r0, 0x54(r1)
/* 801D4E60 001D1F40  38 21 00 50 */	addi r1, r1, 0x50
/* 801D4E64 001D1F44  7C 08 03 A6 */	mtlr r0
/* 801D4E68 001D1F48  4E 80 00 20 */	blr
.endfn __OSInitMemoryProtection

# 0x802B64C0 - 0x802B64D0
.data
.balign 8

.obj ResetFunctionInfo, local
	.4byte OnReset
	.4byte 0x0000007F
	.4byte 0x00000000
	.4byte 0x00000000
.endobj ResetFunctionInfo
